<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <h1>Upload Test</h1>
    <form id="upload-form" method="post" enctype="multipart/form-data">
        <div>
            <label for="upload_file">File</label>
            <input name="upload_file" type="file" />
        </div>
        <button type="submit">Upload</button>
    </form>
    <div>
        <p id="result-message"></p>
    </div>
    <script>
        // https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects
        (function () {
            var form = document.getElementById('upload-form');
            form.addEventListener('submit', function (submitEvt) {
                var resultDisplay = document.getElementById('result-message'),
                    data = new FormData(form);

                resultDisplay.innerHTML = 'Uploading...';

                var req = new XMLHttpRequest();
                req.open('POST', '/api/upload', true);
                req.onload = function (evt) {
                    if (evt.status == 200) {
                        resultDisplay.innerHTML = "Uploaded!";
                    } else {
                        resultDisplay.innerHTML = "Error " + req.status + " occurred when trying to upload your file.<br \/>";
                    }
                };

                req.send(data);
                submitEvt.preventDefault();
            }, false);
        })();
    </script>
</body>
</html>